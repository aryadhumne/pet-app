<!DOCTYPE html>
<html>
<head>
    <title>Nearby Pet Clinics</title>

    <!-- Leaflet Map Library (NO API KEY REQUIRED) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100vh;
            width: 100%;
        }
        .clinic-popup {
            font-size: 14px;
        }
        .clinic-title {
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>

<h2 style="text-align:center; padding:10px;">Nearby Pet Clinics (Within 20 KM)</h2>
<div id="map"></div>

<script>
    // ------------------------
    //  SAMPLE PET CLINIC DATA
    // (Use your Flask database clinics here)
    // ------------------------
    const clinics = [
        {
            name: "Happy Paws Pet Clinic",
            lat: 18.5204,
            lon: 73.8567,
            address: "Pune Camp, Maharashtra"
        },
        {
            name: "Pet Life Hospital",
            lat: 18.5074,
            lon: 73.8077,
            address: "Kothrud, Pune"
        },
        {
            name: "Blue Cross Pet Clinic",
            lat: 18.5800,
            lon: 73.9250,
            address: "Viman Nagar, Pune"
        }
    ];

    // Haversine distance formula
    function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // km
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;

        const a =
            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);

        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
    }

    // Initialize Map
    var map = L.map('map');

    // Ask for user's location
    navigator.geolocation.getCurrentPosition(function (pos) {
        let userLat = pos.coords.latitude;
        let userLon = pos.coords.longitude;

        // Center map on user
        map.setView([userLat, userLon], 12);

        // Add map tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        // Marker for user
        L.marker([userLat, userLon])
            .addTo(map)
            .bindPopup("You are here")
            .openPopup();

        // 20 KM CIRCLE
        L.circle([userLat, userLon], {
            radius: 20000,
            color: "blue",
            fillColor: "#80bfff",
            fillOpacity: 0.2
        }).addTo(map);

        // Show clinics within 20 km
        clinics.forEach(clinic => {
            let dist = calculateDistance(userLat, userLon, clinic.lat, clinic.lon);

            if (dist <= 20) {
                L.marker([clinic.lat, clinic.lon])
                    .addTo(map)
                    .bindPopup(`
                        <div class="clinic-popup">
                            <div class="clinic-title">${clinic.name}</div>
                            <div>${clinic.address}</div>
                            <div><b>Distance:</b> ${dist.toFixed(2)} km</div>
                        </div>
                    `);
            }
        });

    }, function (err) {
        alert("Location permission denied. Please allow it to show nearby clinics.");
    });

</script>

</body>
</html>
