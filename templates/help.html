{% extends "base.html" %}
{% block content %}
<style>
/* REMOVE BASE CONTAINERS */
.page-content > .container { 
  max-width:100%!important; 
  padding:0!important; 
  margin:0!important; 
}
.hero-section,.top-card{display:none!important;}

.chat-landing{
  display:flex;
  justify-content:center;
  margin-top:30px;
}

.hero-img{
  width:85%;
  max-width:360px;
  border-radius:22px;
  box-shadow:0 12px 25px rgba(255, 180, 130, 0.35);
}

/* ===== CHAT CONTAINER ===== */
.chat-container{
  display:none;
  position:fixed;
  bottom:120px;
  right:16px;
  width:92%;
  max-width:380px;
  background:linear-gradient(180deg,#ffb199,#ffd1a3);
  border-radius:20px;
  box-shadow:0 15px 40px rgba(255, 190, 140, 0.4);
  z-index:10000;
}

/* ===== HEADER ===== */
.chat-header{
  color:#5a2a00;
  padding:12px;
  text-align:center;
  position:relative;
  font-weight:600;
}

.close-btn{
  position:absolute;
  right:14px;
  top:10px;
  cursor:pointer;
  font-size:18px;
}

/* ===== LANGUAGE BAR ===== */
.lang-bar{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  padding:8px;
  background:rgba(255,255,255,.4);
  border-top:1px solid rgba(255,255,255,.5);
  border-bottom:1px solid rgba(255,255,255,.5);
  color:#5a2a00;
}

/* ===== CHAT BODY ===== */
.chat-body{
  padding:14px;
  height:260px;
  overflow-y:auto;
  background:#fff6f0;
}

/* ===== MESSAGES ===== */
.chat-message div{
  padding:10px 14px;
  border-radius:15px;
  max-width:78%;
  margin-bottom:10px;
  font-size:14px;
}

.chat-message.user div{
  background:#ff9f80;
  color:#ffffff;
  margin-left:auto;
}

.chat-message.bot div{
  background:#ffe5d6;
  color:#5a2a00;
}

/* ===== INPUT ===== */
.chat-input{
  display:flex;
  border-top:1px solid #f3b28a;
  background:#ffffff;
}

.chat-input input{
  flex:1;
  padding:12px;
  border:none;
  outline:none;
}

.chat-input button{
  background:#ff7043;
  color:#fff;
  border:none;
  padding:0 16px;
  cursor:pointer;
}

/* ===== TOGGLE SWITCH ===== */
.toggle{
  width:42px;
  height:22px;
  position:relative;
}

.toggle input{display:none;}

.slider{
  position:absolute;
  inset:0;
  background:#ffd6c9;
  border-radius:22px;
}

.slider:before{
  content:"";
  position:absolute;
  height:18px;
  width:18px;
  left:2px;
  bottom:2px;
  background:white;
  border-radius:50%;
  transition:.3s;
}

.toggle input:checked+.slider{
  background:#ffb74d;
}

.toggle input:checked+.slider:before{
  transform:translateX(20px);
}

/* ===== START CARD ===== */
.start-card{
  position:absolute;
  bottom:160px;
  left:50%;
  transform:translateX(-50%);
  width:85%;
  max-width:320px;
  background:linear-gradient(180deg,#ffb199,#ffd1a3);
  color:#5a2a00;
  text-align:center;
  padding:18px;
  border-radius:18px;
  box-shadow:0 15px 35px rgba(255, 190, 140, 0.45);
}

/* ===== START BUTTON (RED) ===== */
.start-card button{
  background:#e53935;
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:22px;
  font-weight:600;
  cursor:pointer;
  margin-top:10px;
  box-shadow:0 6px 15px rgba(229,57,53,.4);
}

.start-card button:hover{
  background:#d32f2f;
}
</style>

<div class="chat-landing">
  <img src="{{ url_for('static', filename='images/c1.jpeg') }}" class="hero-img">
</div>

<div class="start-card" id="startCard">
  <h5>Ask anything to the AI Chatbot ðŸ¤–</h5>
  <p>Pet health â€¢ Food â€¢ Vaccination</p>
  <button onclick="openChat()">Start Chatting</button>
</div>

<div class="chat-container" id="chatBox">
  <div class="chat-header">
    Smart AgriPet Care ðŸ¤–
    <span class="close-btn" onclick="closeChat()">âœ–</span>

    <div class="lang-bar">
      <select id="langSelect">
        <option value="en-IN">English</option>
        <option value="hi-IN">Hindi</option>
        <option value="mr-IN">Marathi</option>
      </select>

      <span>Speak</span>
      <label class="toggle">
        <input type="checkbox" id="speakToggle">
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <div class="chat-body" id="chatBody">
    <div class="chat-message bot">
      <div>ðŸ‘‹ Ask me about pet food, health issues, or vaccination.</div>
    </div>
  </div>

  <div class="chat-input">
    <button onclick="startMic()">ðŸŽ¤</button>
    <input id="userInput" placeholder="Type or speak...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const chatBody = document.getElementById("chatBody");
const userInput = document.getElementById("userInput");
const langSelect = document.getElementById("langSelect");
const speakToggle = document.getElementById("speakToggle");

function appendMessage(sender,text){
  const msg=document.createElement("div");
  msg.className="chat-message "+sender;
  msg.innerHTML=`<div>${text}</div>`;
  chatBody.appendChild(msg);
  chatBody.scrollTop=chatBody.scrollHeight;
}

/* ðŸ”Š TEXT TO SPEECH */
function speak(text){
  if(!speakToggle.checked) return;
  speechSynthesis.cancel();
  const utter=new SpeechSynthesisUtterance(text);
  utter.lang=langSelect.value;
  utter.rate=1;
  utter.pitch=1;
  speechSynthesis.speak(utter);
}

function sendMessage(){
  const msg=userInput.value.trim();
  if(!msg) return;
  appendMessage("user",msg);
  userInput.value="";

  fetch("/chatbot",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:msg,lang:langSelect.value})
  })
  .then(r=>r.json())
  .then(d=>{
    appendMessage("bot",d.reply);
    speak(d.reply);
  });
}
function startMic(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){alert("Speech not supported");return;}
  const rec=new SR();
  rec.lang=langSelect.value;
  rec.onresult=e=>{
    userInput.value=e.results[0][0].transcript;
    sendMessage();
  };
  rec.start();
}

function openChat(){
  chatBox.style.display="block";
  startCard.style.display="none";
}
function closeChat(){
  chatBox.style.display="none";
  startCard.style.display="block";
}
</script>

{% endblock %}